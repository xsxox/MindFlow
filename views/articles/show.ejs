<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= article.title %> - MindFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .article-content { font-size: 1.1rem; line-height: 1.8; color: #2c3e50; }
        .article-content img { max-width: 100%; height: auto; border-radius: 8px; margin: 15px 0; }
        .article-content h1, h2, h3 { margin-top: 1.5rem; color: #000; }
        .article-content pre { background: #f8f9fa; padding: 1rem; border-radius: 6px; overflow-x: auto; }
        .article-content blockquote { border-left: 4px solid #ccc; padding-left: 1rem; color: #666; }
    </style>
</head>
<body class="bg-light">

    <!-- å¯¼èˆªæ  (ä¸é¦–é¡µä¿æŒä¸€è‡´) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">MindFlow</a>
            <div class="navbar-nav ms-auto">
                <% if (currentUser) { %>
                     <span class="nav-link text-light me-2">Hi, <%= currentUser %></span>
                <% } %>
                <a href="/" class="nav-link text-light">è¿”å›é¦–é¡µ</a>
            </div>
        </div>
    </nav>

    <div class="container">
        
        <!-- ================= æ–‡ç« å¡ç‰‡ ================= -->
        <div class="card shadow-sm mb-5">
            <div class="card-body p-4 p-md-5">
                <!-- æ ‡é¢˜ -->
                <h1 class="fw-bold mb-3 display-5"><%= article.title %></h1>
                
                <!-- ä½œè€…ä¸æ—¶é—´ä¿¡æ¯ -->
                <div class="d-flex align-items-center text-muted border-bottom pb-3 mb-4">
                    <div class="me-3">
                        ä½œè€…: 
                        <!-- â˜…â˜…â˜… ä½œè€…æ˜¾ç¤ºé€»è¾‘ â˜…â˜…â˜… -->
                        <strong class="text-primary">
                            @<%= article.author ? article.author.username : 'åŒ¿åç”¨æˆ·' %>
                        </strong>
                    </div>
                    <div>
                        å‘å¸ƒäº: <%= article.createdAt.toLocaleString() %>
                    </div>
                </div>

                <!-- æ­£æ–‡å†…å®¹ (æ¸²æŸ“ Markdown è½¬æ¢åçš„ HTML) -->
                <div class="article-content">
                    <%- htmlContent %>
                </div>

                <!-- åº•éƒ¨æ“ä½œæ  -->
                <div class="mt-5 pt-4 border-top">
                    <a href="/" class="btn btn-outline-secondary">&larr; è¿”å›åˆ—è¡¨</a>
                </div>
            </div>
        </div>


        <!-- ================= è¯„è®ºåŒº (Ajax) ================= -->
        <div class="card shadow-sm mb-5">
            <div class="card-header bg-white py-3">
                <h5 class="m-0 fw-bold">ğŸ’¬ è¯„è®ºåŒº</h5>
            </div>
            <div class="card-body">
                
                <!-- 1. è¯„è®ºè¾“å…¥æ¡† -->
                <% if (currentUser) { %>
                    <div class="d-flex gap-2 align-items-start mb-4">
                        <textarea 
                            id="comment-content" 
                            class="form-control" 
                            rows="2" 
                            placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..."
                        ></textarea>
                        <button onclick="submitComment()" class="btn btn-primary text-nowrap px-4">å‘è¡¨</button>
                    </div>
                <% } else { %>
                    <div class="alert alert-secondary mb-4">
                        è¯· <a href="/auth/login" class="fw-bold">ç™»å½•</a> åå‘è¡¨è¯„è®º
                    </div>
                <% } %>

                <!-- 2. è¯„è®ºåˆ—è¡¨å®¹å™¨ (JS åŠ¨æ€å¡«å……) -->
                <div id="comment-list">
                    <div class="text-center text-muted py-3">æ­£åœ¨åŠ è½½è¯„è®º...</div>
                </div>

            </div>
        </div>

    </div>

    <!-- ================= è„šæœ¬åŒºåŸŸ ================= -->
    
    <!-- 1. ä¼ é€’ ID ç»™ JS -->
    <script>
        const articleId = "<%= article.id %>";
    </script>

    <!-- 2. Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 3. Ajax è¯„è®ºè„šæœ¬ -->
    <script src="/js/comment.js"></script>

</body>
</html>