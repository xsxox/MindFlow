<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= article.title %> - MindFlow</title>
    <!-- 引入 Bootstrap 样式 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 针对文章内容的简单样式优化 */
        .article-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
        }
        .article-content h1, .article-content h2, .article-content h3 {
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        .article-content p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #333;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-light">

    <!-- 顶部导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">MindFlow</a>
            <div class="navbar-nav ms-auto">
                <a href="/articles/new" class="nav-link">写文章</a>
            </div>
        </div>
    </nav>

    <div class="container">
        
        <!-- ================= 文章主体区域 ================= -->
        <div class="card shadow-sm mb-5">
            <div class="card-body p-4 p-md-5">
                <!-- 1. 标题 -->
                <h1 class="fw-bold mb-3"><%= article.title %></h1>
                
                <!-- 2. 信息栏 -->
                <div class="text-muted border-bottom pb-3 mb-4 d-flex justify-content-between align-items-center">
                    <span>
                        <i class="bi bi-clock"></i> 发布于: <%= article.createdAt.toLocaleString() %>
                    </span>
                    <!-- 预留的编辑按钮，暂时先放个样子 -->
                    <a href="#" class="btn btn-outline-secondary btn-sm disabled">编辑</a>
                </div>

                <!-- 3. 文章内容 (渲染转换后的 HTML) -->
                <div class="article-content">
                    <!-- <%- %> 用于输出非转义的 HTML 代码 -->
                    <%- htmlContent %>
                </div>

                <!-- 4. 底部返回按钮 -->
                <div class="mt-5 border-top pt-4">
                    <a href="/" class="btn btn-secondary">&larr; 返回文章列表</a>
                </div>
            </div>
        </div>


        <!-- ================= 评论区 (Ajax 核心部分) ================= -->
        <div class="card shadow-sm mb-5">
            <div class="card-header bg-white py-3">
                <h5 class="m-0">评论区</h5>
            </div>
            <div class="card-body">
                
                <!-- 1. 评论列表容器 (JS 会把获取到的评论塞到这里) -->
                <div id="comment-list" class="mb-4">
                    <div class="text-center text-muted py-3">正在加载评论...</div>
                </div>

                <!-- 2. 发布评论表单 -->
                <div class="d-flex gap-2 align-items-start">
                    <textarea 
                        id="comment-content" 
                        class="form-control" 
                        rows="2" 
                        placeholder="写下你的想法... (支持 Ajax 无刷新提交)"
                    ></textarea>
                    <!-- 注意：这里绑定了 onclick 事件 -->
                    <button onclick="submitComment()" class="btn btn-primary text-nowrap">发表评论</button>
                </div>

            </div>
        </div>

    </div>

    <!-- ================= JavaScript 部分 ================= -->
    
    <!-- 1. 将后端传递的文章 ID 赋值给前端 JS 变量 -->
    <script>
        const articleId = "<%= article.id %>";
    </script>

    <!-- 2. 引入 Bootstrap JS (可选，用于弹窗等) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- 3. 引入我们自己写的 Ajax 逻辑脚本 -->
    <script src="/js/comment.js"></script>

</body>
</html>